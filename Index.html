<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULTRA PIXEL BANANA: HALL OF FAME</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --pixel-border: 6px solid #000;
            --accent: #facc15;
            --main-bg: #064e3b;
            --panel-bg: #78350f;
            --header-bg: #166534;
            --text-box: #fef9c3;
        }

        /* THEMES */
        body.theme-default { --main-bg: #064e3b; --accent: #facc15; --header-bg: #166534; --panel-bg: #78350f; --text-box: #fef9c3; }
        body.theme-spring { --main-bg: #14532d; --accent: #4ade80; --header-bg: #166534; --panel-bg: #064e3b; --text-box: #dcfce7; }
        body.theme-summer { --main-bg: #7c2d12; --accent: #fbbf24; --header-bg: #9a3412; --panel-bg: #7c2d12; --text-box: #fef3c7; }
        body.theme-autumn { --main-bg: #431407; --accent: #f97316; --header-bg: #7c2d12; --panel-bg: #451a03; --text-box: #ffedd5; }
        body.theme-winter { --main-bg: #0c4a6e; --accent: #7dd3fc; --header-bg: #075985; --panel-bg: #0c4a6e; --text-box: #e0f2fe; }
        body.theme-halloween { --main-bg: #0c0a09; --accent: #fb923c; --header-bg: #ea580c; --panel-bg: #441907; --text-box: #fed7aa; }
        body.theme-christmas { --main-bg: #052e16; --accent: #ef4444; --header-bg: #991b1b; --panel-bg: #7f1d1d; --text-box: #fee2e2; }
        body.theme-valentine { --main-bg: #4c0519; --accent: #fda4af; --header-bg: #9d174d; --panel-bg: #831843; --text-box: #ffe4e6; }
        body.theme-newyear { --main-bg: #1e1b4b; --accent: #fcd34d; --header-bg: #312e81; --panel-bg: #1e1b4b; --text-box: #eef2ff; }

        body, html { height: 100%; margin: 0; font-family: 'VT323', monospace; background-color: var(--main-bg); overflow: hidden; display: flex; flex-direction: column; transition: all 0.5s ease; }
        .pixel-engine { image-rendering: pixelated; filter: url(#pixelate) contrast(160%) saturate(140%) drop-shadow(0 8px 0 rgba(0,0,0,0.4)); display: inline-block; }
        
        .main-game-area { display: grid; grid-template-columns: 320px 1fr 320px; flex: 1; padding: 15px; gap: 20px; height: calc(100vh - 65px); z-index: 10; position: relative; }
        .side-panel { border: var(--pixel-border); background: var(--panel-bg); display: flex; flex-direction: column; overflow-y: auto; box-shadow: 8px 8px 0 #000; }
        .center-stage { display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 10px 0; height: 100%; }
        
        .header { background: var(--header-bg); color: var(--accent); padding: 12px; font-size: 1.8rem; text-align: center; border-bottom: var(--pixel-border); text-transform: uppercase; position: relative; }
        .buy-card { background: var(--header-bg); border: 4px solid #000; color: var(--accent); padding: 14px; margin: 10px; cursor: pointer; display: none; position: relative; box-shadow: 0 6px 0 #000; transition: transform 0.05s; user-select: none; }
        .buy-card.discovered { display: block; }
        .buy-card:active { transform: translateY(4px); box-shadow: 0 2px 0 #000; }
        .buy-card.locked { filter: brightness(0.5); cursor: not-allowed; }
        
        .owned-tag { position: absolute; top: -12px; right: -5px; background: #000; color: #fff; padding: 2px 8px; font-size: 1rem; border: 2px solid var(--accent); z-index: 5; }
        
        .empire-box { background: #000; border: var(--pixel-border); color: var(--accent); padding: 5px 20px; margin-bottom: 10px; font-size: 1.8rem; text-transform: uppercase; letter-spacing: 2px; box-shadow: 6px 6px 0 rgba(0,0,0,0.3); position: relative; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .rename-btn { background: #333; color: #fff; border: 2px solid var(--accent); font-family: 'VT323'; cursor: pointer; font-size: 1rem; padding: 2px 6px; }

        .stats-box { background: var(--text-box); border: var(--pixel-border); padding: 12px; width: 95%; text-align: center; box-shadow: 10px 10px 0 #000; }
        .score-display { font-size: 4rem; color: #000; line-height: 0.9; }

        .leaderboard-container { width: 100%; background: #000; border: var(--pixel-border); color: var(--accent); flex: 1; overflow: hidden; margin-top: 15px; box-shadow: 8px 8px 0 rgba(0,0,0,0.5); display: flex; flex-direction: column; }
        #lb-content, #hof-content { overflow-y: auto; flex: 1; font-size: 1.4rem; padding: 5px; }

        #emoji-clicker { font-size: 180px; cursor: pointer; user-select: none; transition: transform 0.05s; margin: 5px 0; }
        #emoji-clicker:active { transform: scale(0.85); }

        .news-ticker { height: 65px; background: #000; border-top: var(--pixel-border); color: var(--accent); display: flex; align-items: center; overflow: hidden; position: relative; z-index: 100; }
        .ticker-text { display: inline-block; padding-left: 100%; animation: scroll-news 900s linear infinite; font-size: 2.2rem; white-space: nowrap; }
        @keyframes scroll-news { from { transform: translateX(0); } to { transform: translateX(-100%); } }

        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal { background: var(--panel-bg); border: var(--pixel-border); color: #fff; max-width: 600px; padding: 30px; box-shadow: 15px 15px 0 #000; position: relative; }
        
        #particle-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .falling-item { position: absolute; font-size: 25px; animation: fall linear forwards; cursor: pointer; pointer-events: auto; }
        .rare-item { font-size: 60px; z-index: 999; animation: rare-pop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), fall 8s linear forwards; }
        @keyframes fall { from { top: -10vh; transform: rotate(0deg); } to { top: 110vh; transform: rotate(360deg); } }
        .shimmer-angel { filter: url(#pixelate) drop-shadow(0 0 20px white) brightness(1.2); }
        .shimmer-gold { filter: url(#pixelate) sepia(1) saturate(10) hue-rotate(40deg) drop-shadow(0 0 15px gold); }
    </style>
</head>
<body class="theme-default">

<svg width="0" height="0" style="position:absolute"><filter id="pixelate" x="0" y="0"><feFlood x="4" y="4" height="2" width="2"/><feComposite width="4" height="4"/><feTile/><feComposite in="SourceGraphic" operator="in"/><feMorphology operator="dilate" radius="2"/></filter></svg>

<div id="overlay">
    <div class="modal">
        <h1 style="color:var(--accent); text-align:center;">WELCOME TO BANANA EMPIRE</h1>
        <ul style="font-size:1.4rem; list-style-type: 'üçå ';">
            <li><b>EMPIRE GROWTH:</b> Click the center emoji to harvest.</li>
            <li><b>RARITIES:</b> 20% <b>GOLDEN</b> (50x) & 1% <b>ANGELIC</b> (500x) every 60s!</li>
            <li><b>HALL OF FAME:</b> See the legendary tycoons with the most Rebirths.</li>
        </ul>
        <button id="close-welcome" style="width:100%; padding:15px; background:var(--accent); font-family:'VT323'; font-size:1.5rem; cursor:pointer; border:4px solid #000;">START HARVESTING</button>
    </div>
</div>

<div id="particle-container"></div>

<div class="main-game-area">
    <div class="side-panel">
        <div class="header">Market <button class="help-btn" onclick="document.getElementById('overlay').style.display='flex'">?</button></div>
        <div id="market-list"></div>
        <div class="header" style="margin-top:20px;">Holiday Timeline</div>
        <div style="padding:15px;">
            <select id="theme-sel" onchange="updateSeasonNews(this.value)" style="width:100%; font-family:'VT323'; background:#000; color:white; border:4px solid var(--accent); font-size:1.4rem;">
                <option value="default">JUNGLE üå¥</option>
                <option value="newyear">NEW YEAR'S DAY üéÜ</option>
                <option value="valentine">VALENTINE'S DAY ‚ù§Ô∏è</option>
                <option value="spring">SPRING / EASTER üå∏</option>
                <option value="july4">INDEPENDENCE DAY üóΩ</option>
                <option value="halloween">HALLOWEEN üéÉ</option>
                <option value="christmas">CHRISTMAS üéÑ</option>
            </select>
            <div id="chat-container" style="margin-top:20px; border:2px solid #000; height:150px; display:flex; flex-direction:column; background:#000;">
                <div id="chat-msgs" style="flex:1; overflow-y:auto; color:white; padding:5px; font-size:0.9rem;"></div>
                <input type="text" id="chat-in" placeholder="Chat..." style="background:#111; border:none; color:var(--accent); font-family:'VT323'; padding:5px;">
            </div>
        </div>
    </div>

    <div class="center-stage">
        <div class="empire-box" id="empire-container">
            <span id="empire-name">LOADING...</span>
            <button class="rename-btn" onclick="changeName()">EDIT</button>
        </div>
        <div class="stats-box">
            <div id="score" class="score-display">0</div>
            <div style="font-size:1.4rem; color:#333; font-weight:bold;">BPS: <span id="bps">0</span> | POW: <span id="pow">1</span></div>
        </div>
        <div id="emoji-clicker" class="pixel-engine">üçå</div>
        
        <div class="leaderboard-container">
            <div class="header" style="font-size:1.2rem; padding:5px; border-bottom:var(--pixel-border);">GLOBAL RANKS</div>
            <div id="lb-content"></div>
            <div class="header" style="font-size:1.2rem; padding:5px; border-top:var(--pixel-border); border-bottom:var(--pixel-border);">HALL OF FAME (REBIRTHS)</div>
            <div id="hof-content"></div>
        </div>
    </div>

    <div class="side-panel">
        <div class="header">Workforce</div>
        <div id="producer-list"></div>
        <div class="header" style="margin-top:10px;">Your Assets</div>
        <div id="asset-display"></div>
    </div>
</div>

<div class="news-ticker"><div class="ticker-text" id="news-content">GNN: INITIALIZING...</div></div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyCTmXjtfuN-2DGJq9IUpCVvDk88IkFQSFg", authDomain: "banana-empire-42fda.firebaseapp.com", databaseURL: "https://banana-empire-42fda-default-rtdb.firebaseio.com", projectId: "banana-empire-42fda", storageBucket: "banana-empire-42fda.firebasestorage.app", messagingSenderId: "833181965750", appId: "1:833181965750:web:2abf119335bee9a0157517" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const upgrades = {
        market: [
            {id:'m1', name:'Sticky Fingers', base:15, power:1},
            {id:'m2', name:'Silverback Grip', base:150, power:5},
            {id:'m3', name:'Golden Peeler', base:1000, power:20},
            {id:'m4', name:'Banana Magnet', base:5000, power:75},
            {id:'m5', name:'Carbon-Fiber Vine', base:25000, power:200},
            {id:'m6', name:'Cyber-Monkey Arm', base:100000, power:600},
            {id:'m7', name:'Gravity Glove', base:500000, power:1500},
            {id:'m8', name:'Quantum Clicker', base:2000000, power:5000},
            {id:'m9', name:'Singularity Squeeze', base:10000000, power:15000},
            {id:'m10', name:'Divine Hand', base:50000000, power:50000}
        ],
        producer: [
            {id:'p1', name:'Rookie Chimp', base:50, bps:2, icon:'üêí'},
            {id:'p2', name:'Banana Orchard', base:500, bps:10, icon:'üå≥'},
            {id:'p3', name:'Gorilla Factory', base:3000, bps:40, icon:'üè≠'},
            {id:'p4', name:'Industrial Blender', base:15000, bps:120, icon:'ü•§'},
            {id:'p5', name:'Tree Geneticist', base:75000, bps:450, icon:'üß¨'},
            {id:'p6', name:'Space Station Farm', base:350000, bps:1500, icon:'üöÄ'},
            {id:'p7', name:'Atmospheric Ripper', base:1500000, bps:5000, icon:'üå©Ô∏è'},
            {id:'p8', name:'Time Portal Peeler', base:8000000, bps:20000, icon:'üåÄ'},
            {id:'p9', name:'Galaxy Harvester', base:40000000, bps:85000, icon:'üåå'},
            {id:'p10', name:'Existence Itself', base:200000000, bps:250000, icon:'‚ú®'}
        ]
    };

    let bananas = parseFloat(localStorage.getItem('bananas')) || 0;
    let counts = JSON.parse(localStorage.getItem('upgradeCounts')) || {};
    let rebirths = parseInt(localStorage.getItem('rebirths')) || 0;
    let playerName = localStorage.getItem('pixelPlayerName') || "Primate_" + Math.floor(Math.random()*999);
    let currentTheme = 'default';

    const themeMap = { default:'üçå', spring:'üå∏', summer:'‚òÄÔ∏è', halloween:'üéÉ', christmas:'üéÑ', valentine:'‚ù§Ô∏è', newyear:'üéÜ', july4:'üóΩ' };

    async function changeName() {
        let newName = prompt("Enter your new unique Empire name (Max 15 characters):", playerName);
        if (newName) {
            newName = newName.trim().substring(0, 15);
            const snapshot = await db.ref('players').orderByChild('name').equalTo(newName).once('value');
            if (snapshot.exists() && newName !== playerName) {
                alert("That name is already taken!");
            } else {
                playerName = newName;
                localStorage.setItem('pixelPlayerName', playerName);
                updateUI();
                save();
            }
        }
    }

    function performRebirth() {
        if (confirm("Rebirth? You will lose everything but gain a PERMANENT 2x multiplier!")) {
            rebirths++;
            bananas = 0;
            counts = {};
            localStorage.setItem('rebirths', rebirths);
            localStorage.setItem('bananas', 0);
            localStorage.setItem('upgradeCounts', JSON.stringify({}));
            const rbBtn = document.getElementById('rebirth-btn');
            if(rbBtn) rbBtn.remove();
            updateUI();
            save();
        }
    }

    function updateUI() {
        let curBps = 0, curPow = 1;
        upgrades.market.forEach(u => curPow += (counts[u.id] || 0) * u.power);
        upgrades.producer.forEach(u => curBps += (counts[u.id] || 0) * u.bps);
        
        let multiplier = Math.pow(2, rebirths);
        curBps *= multiplier; curPow *= multiplier;

        document.getElementById('score').innerText = Math.floor(bananas).toLocaleString();
        document.getElementById('bps').innerText = Math.floor(curBps).toLocaleString();
        document.getElementById('pow').innerText = Math.floor(curPow).toLocaleString();

        const vBadge = bananas >= 1000000 ? ' <span style="color:#38bdf8; font-weight:bold;">[‚úì]</span>' : '';
        const rBadge = rebirths > 0 ? ` <span style="color:#facc15;">[R${rebirths}]</span>` : '';
        document.getElementById('empire-name').innerHTML = playerName.toUpperCase() + "'S EMPIRE" + vBadge + rBadge;

        if (bananas >= 1000000000 && !document.getElementById('rebirth-btn')) {
            const rbBtn = document.createElement('button');
            rbBtn.id = 'rebirth-btn';
            rbBtn.innerText = "REBIRTH";
            rbBtn.style = "background:#ef4444; color:white; border:2px solid #000; font-family:'VT323'; cursor:pointer; margin-left:10px; font-size:1rem; padding:2px 6px;";
            rbBtn.onclick = performRebirth;
            document.getElementById('empire-container').appendChild(rbBtn);
        }

        [...upgrades.market, ...upgrades.producer].forEach(u => {
            const el = document.getElementById('btn-' + u.id);
            if(!el) return;
            const cost = Math.floor(u.base * Math.pow(1.15, (counts[u.id] || 0)));
            if (bananas >= cost * 0.7 || counts[u.id] > 0) {
                el.classList.add('discovered');
                el.classList.toggle('locked', bananas < cost);
            }
            el.innerHTML = `${u.name} <div class="owned-tag">${counts[u.id] || 0}</div><span style="float:right">$${cost.toLocaleString()}</span>`;
        });

        const assetBox = document.getElementById('asset-display');
        assetBox.innerHTML = '';
        upgrades.producer.forEach(u => {
            if(counts[u.id] > 0) {
                assetBox.innerHTML += `<div class="asset-row"><span class="asset-icon">${u.icon}</span><div><b>${u.name} x${counts[u.id]}</b><br><small>+${(counts[u.id]*u.bps*multiplier).toLocaleString()} BPS</small></div></div>`;
            }
        });
    }

    function spawnRare(type) {
        const b = document.createElement('div');
        b.className = 'falling-item rare-item pixel-engine ' + (type === 'angelic' ? 'shimmer-angel' : 'shimmer-gold');
        b.innerText = type === 'angelic' ? 'üëº' : 'üçå';
        b.style.left = Math.random() * 80 + 10 + 'vw';
        b.onclick = () => { 
            let p = 1; upgrades.market.forEach(u => p += (counts[u.id] || 0) * u.power);
            bananas += (p * (type === 'angelic' ? 500 : 50) * Math.pow(2, rebirths)); 
            b.remove(); updateUI(); 
        };
        document.getElementById('particle-container').appendChild(b);
        setTimeout(() => b.remove(), 8000);
    }

    function save() {
        localStorage.setItem('bananas', bananas);
        localStorage.setItem('upgradeCounts', JSON.stringify(counts));
        db.ref('players/' + playerName).set({ name: playerName, score: Math.floor(bananas), rebirths: rebirths });
    }

    upgrades.market.forEach(u => document.getElementById('market-list').innerHTML += `<div class="buy-card" id="btn-${u.id}" onclick="buyItem('market','${u.id}')"></div>`);
    upgrades.producer.forEach(u => document.getElementById('producer-list').innerHTML += `<div class="buy-card" id="btn-${u.id}" onclick="buyItem('producer','${u.id}')"></div>`);

    function buyItem(type, id) {
        const u = upgrades[type].find(x => x.id === id);
        const cost = Math.floor(u.base * Math.pow(1.15, (counts[id] || 0)));
        if(bananas >= cost) { bananas -= cost; counts[id] = (counts[id] || 0) + 1; updateUI(); save(); }
    }

    document.getElementById('emoji-clicker').onclick = () => {
        let p = 1; upgrades.market.forEach(u => p += (counts[u.id] || 0) * u.power);
        bananas += (p * Math.pow(2, rebirths)); updateUI();
    };

    // Global Score Leaderboard
    db.ref('players').orderByChild('score').limitToLast(10).on('value', s => {
        let players = []; s.forEach(c => players.push(c.val()));
        players.sort((a,b) => b.score - a.score);
        document.getElementById('lb-content').innerHTML = players.map((x,i) => {
            const v = x.score >= 1000000 ? ' <span style="color:#38bdf8;">[‚úì]</span>' : '';
            return `<div style="padding:4px; border-bottom:1px solid #222">#${i+1} ${x.name}${v}: ${x.score.toLocaleString()}</div>`;
        }).join('');
    });

    // Hall of Fame (Rebirths) Leaderboard
    db.ref('players').orderByChild('rebirths').limitToLast(10).on('value', s => {
        let players = []; s.forEach(c => players.push(c.val()));
        players.sort((a,b) => b.rebirths - a.rebirths);
        document.getElementById('hof-content').innerHTML = players.map((x,i) => {
            if (x.rebirths < 1) return "";
            return `<div style="padding:4px; border-bottom:1px solid #222">‚≠ê ${x.name}: ${x.rebirths} REBIRTHS</div>`;
        }).join('');
    });

    if (!localStorage.getItem('welcomeSeen')) document.getElementById('overlay').style.display = 'flex';
    document.getElementById('close-welcome').onclick = () => { document.getElementById('overlay').style.display='none'; localStorage.setItem('welcomeSeen','true'); };

    setInterval(() => { let b = 0; upgrades.producer.forEach(u => b += (counts[u.id] || 0) * u.bps); bananas += (b * Math.pow(2, rebirths))/10; updateUI(); }, 100);
    setInterval(() => { const r = Math.random(); if(r < 0.01) spawnRare('angelic'); else if(r < 0.21) spawnRare('golden'); }, 60000);
    setInterval(save, 30000);
    updateUI();
</script>
</body>
</html>
